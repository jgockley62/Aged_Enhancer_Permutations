#usr/bin/perl 

use warnings;
use strict;

#Serches through the result of a Bed file intersection and changes:
#chr1    15055800        15056250        Mammalia        chr1    15055250        15060775        chr1:15055250-15060775
#chr1    15057450        15057750        Mammalia        chr1    15055250        15060775        chr1:15055250-15060775


#Into
#chr1    15055250        15060775  	chr1:15055800-15056250;chr1:15057450-15057750

#Usage: perl 2016_01_31_Anotate.pl <<INPUT.bed>> > Output.bed
my $hand1=$ARGV[0];
my %Enh=();

#Load Bed Coordinates
open FILE1, "$hand1" or die "Could not open $hand1: $!\n";
while(my $tmp = <FILE1>){
    $tmp =~ s/[\n\r]//g;
    my @line = split /\t/, $tmp;
    my $Core=$line[0].":".$line[1]."-".$line[2];
    
    if(exists $Enh{$line[4]."\t".$line[5]."\t".$line[6]}){
		 $Enh{$line[4]."\t".$line[5]."\t".$line[6]}=$Enh{$line[4]."\t".$line[5]."\t".$line[6]}.";".$Core;       
    }else{    
        $Enh{$line[4]."\t".$line[5]."\t".$line[6]}=$Core;  
    }
}
close FILE1;


#Output for Comparisons Chimp Fragments
my $RearangedBED = 'ReAranged.bed';
open(my $RE, '>', $RearangedBED) or die "Could not open file '$RearangedBED' $!";
#print $Ac "My first report generated by perl\n";

foreach my $key ( keys %Enh )
{
  print $RE $key."\t".$Enh{$key}."\n";
}

#sort -k1,1 -k2,2n Windowed_SUBS_NO_Dups.bed > Windowed_SUBS_NO_Dups_srt.bed
system("sort -k1,1 -k2,2n ReAranged.bed > foo.bed");
system("mv foo.bed ReAranged.bed");